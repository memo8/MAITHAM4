â–„â–€          Rebot  :   Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠ       â–€â–„ â–„â–€ â–€â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€--]]--An empty table for solving multiple kicking problem(thanks to @MAITHAMO_O )kicktable = {}dolocal TIME_CHECK = 2 -- seconds-- Save stats, ban userlocal function pre_process(msg)  -- Ignore service msg  if msg.service then    return msg  end  if msg.from.id == our_id then    return msg  end      -- Save user on Redis  if msg.from.type ==  user  then    local hash =  user: ..msg.from.id    print( Saving user , hash)    if msg.from.print_name then      redis:hset(hash,  print_name , msg.from.print_name)    end    if msg.from.first_name then      redis:hset(hash,  first_name , msg.from.first_name)    end    if msg.from.last_name then      redis:hset(hash,  last_name , msg.from.last_name)    end  end  -- Save stats on Redis  if msg.to.type ==  chat  then    -- User is on chat    local hash =  chat: ..msg.to.id.. :users     redis:sadd(hash, msg.from.id)  end  -- Save stats on Redis  if msg.to.type ==  channel  then    -- User is on channel    local hash =  channel: ..msg.to.id.. :users     redis:sadd(hash, msg.from.id)  end    if msg.to.type ==  user  then    -- User is on chat    local hash =  PM: ..msg.from.id    redis:sadd(hash, msg.from.id)  end  -- Total user msgs  local hash =  msgs: ..msg.from.id.. : ..msg.to.id  redis:incr(hash)  --Load moderation data  local data = load_data(_config.moderation.data)  if data[tostring(msg.to.id)] then    --Check if flood is on or off    if data[tostring(msg.to.id)][ settings ][ flood ] ==  no  then      return msg    end  end  -- Check flood  if msg.from.type ==  user  then    local hash =  user: ..msg.from.id.. :msgs     local msgs = tonumber(redis:get(hash) or 0)    local data = load_data(_config.moderation.data)    local NUM_MSG_MAX = 5    if data[tostring(msg.to.id)] then      if data[tostring(msg.to.id)][ settings ][ flood_msg_max ] then        NUM_MSG_MAX = tonumber(data[tostring(msg.to.id)][ settings ][ flood_msg_max ])--Obtain group flood sensitivity      end    end    local max_msg = NUM_MSG_MAX * 1    if msgs > max_msg then   local user = msg.from.id   local chat = msg.to.id   local whitelist = "whitelist"   local is_whitelisted = redis:sismember(whitelist, user)      -- Ignore mods,owner and admins      if is_momod(msg) then         return msg      end   if is_whitelisted == true then  return msg   end   local receiver = get_receiver(msg)   if msg.to.type ==  user  then  local max_msg = 7 * 1  print(msgs)  if msgs >= max_msg then   print("Pass2")   send_large_msg("user#id"..msg.from.id, "User ["..msg.from.id.."] blocked for spam.")   savelog(msg.from.id.." PM", "User ["..msg.from.id.."] blocked for spam.")   block_user("user#id"..msg.from.id,ok_cb,false)--Block user if spammed in private  end      end   if kicktable[user] == true then  return   end   delete_msg(msg.id, ok_cb, false)   kick_user(user, chat)   local username = msg.from.username   local print_name = user_print_name(msg.from):gsub("â€®", "")   local name_log = print_name:gsub("_", "")   if msg.to.type ==  chat  or msg.to.type ==  channel  then  if username then   savelog(msg.to.id, name_log.."#User @"..username.." kicked for #spam")   send_large_msg(receiver , "ØªÙ… âœ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªÙÙ„ÙŠØ´ ğŸ”\nØªÙ… Ø·Ø±Ø¯ Ø§Ù„Ø¹Ø¶Ùˆ ğŸ‘¤ğŸ”· \nÙŠØ±Ø¬Ù‰ Ø§ØªØ¨Ø§Ø¹ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†  âœ”ï¸ğŸ“‹\n ØªØ±Ø§ Ø§Ù†ÙŠ ØªØ§Ø¬ Ø±Ø§Ø³ÙƒÙ… Ø³Ø§Ù‚Ø· ğŸ˜’\n Ù„Ø­Ø¯ ÙŠØ­Ø§ÙˆÙ„ ÙŠÙÙ„Ø´  ÙˆÙ…Ø·ÙˆØ±ÙŠ Ù…Ø³ÙˆÙŠÙ†ÙŠ ğŸ”«ğŸŒš #User@"..username.."["..msg.from.id.."]\n")  else   savelog(msg.to.id, name_log.." kicked for #spam")   send_large_msg(receiver , "ØªÙ… âœ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªÙÙ„ÙŠØ´ ğŸ”\nØªÙ… Ø·Ø±Ø¯ Ø§Ù„Ø¹Ø¶Ùˆ ğŸ‘¤ğŸ”· \nÙŠØ±Ø¬Ù‰ Ø§ØªØ¨Ø§Ø¹ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†  âœ”ï¸ğŸ“‹\n ØªØ±Ø§ Ø§Ù†ÙŠ ØªØ§Ø¬ Ø±Ø§Ø³ÙƒÙ… Ø³Ø§Ù‚Ø· ğŸ˜’\n Ù„Ø­Ø¯ ÙŠØ­Ø§ÙˆÙ„ ÙŠÙÙ„Ø´  ÙˆÙ…Ø·ÙˆØ±ÙŠ Ù…Ø³ÙˆÙŠÙ†ÙŠ ğŸ”«ğŸŒš #User@"..username.."["..msg.from.id.."]\n")  end   end      -- incr it on redis      local gbanspam =  gban:spam ..msg.from.id      redis:incr(gbanspam)      local gbanspam =  gban:spam ..msg.from.id      local gbanspamonredis = redis:get(gbanspam)      --Check if user has spammed is group more than 4 times        if gbanspam
